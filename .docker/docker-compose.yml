version: '3.8'

services:
  # SmartPLC AI Agent Application
  plc-studio:
    build:
      context: ..
      dockerfile: .docker/Dockerfile
    container_name: plc-monitoring-studio
    environment:
      # OpenAI Configuration
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      
      # Application Settings
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG_MODE=${DEBUG_MODE:-false}
      
      # Display for GUI (Linux)
      - DISPLAY=${DISPLAY:-:0}
      - QT_X11_NO_MITSHM=1
    
    volumes:
      # Persist data
      - ../data:/app/data
      
      # Configuration
      - ../.env:/app/.env:ro
      - ../config:/app/config:ro
      
      # Knowledge base
      - ../knowledge_base:/app/knowledge_base:ro
      
      # X11 socket for GUI (Linux)
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    
    networks:
      - plc-network
    
    restart: unless-stopped
    
    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Optional: Backend API Service (for future web interface)
  # plc-api:
  #   build:
  #     context: ./api
  #     dockerfile: Dockerfile
  #   container_name: plc-api
  #   ports:
  #     - "8000:8000"
  #   environment:
  #     - OPENAI_API_KEY=${OPENAI_API_KEY}
  #     - DATABASE_URL=sqlite:///data/db/plc_data.db
  #   volumes:
  #     - ./plc_data.db:/app/plc_data.db
  #   networks:
  #     - plc-network
  #   restart: unless-stopped

networks:
  plc-network:
    driver: bridge

volumes:
  plc-data:
    driver: local
  vector-store:
    driver: local
